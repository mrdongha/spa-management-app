{% extends 'sales/base.html' %}
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<style>
    @media print {
        body > nav, .btn, .d-flex.justify-content-between.align-items-center { display: none !important; }
        .container { max-width: 100% !important; width: 100% !important; }
        .card { border: none !important; box-shadow: none !important; }
    }
</style>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ page_title }}</h1>
    <div>
        <button onclick="window.print()" class="btn btn-sm btn-outline-secondary">üñ®Ô∏è In h√≥a ƒë∆°n</button>
        {% if invoice.status == 'unpaid' %}
            <a href="{% url 'record_payment' invoice.id %}" class="btn btn-success">Thanh to√°n ngay</a>
        {% endif %}
    </div>
</div>

<div id="invoice-content">
    <div class="card">
        <div class="card-header fw-bold">
            Th√¥ng tin chung
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Kh√°ch h√†ng:</strong> {{ invoice.customer.full_name }}</li>
            <li class="list-group-item"><strong>Nh√¢n vi√™n t∆∞ v·∫•n:</strong> {{ invoice.staff.username|default:"Kh√¥ng c√≥" }}</li>
            <li class="list-group-item"><strong>S·ªë d∆∞ t√≠n d·ª•ng:</strong> <span class="fw-bold text-primary">{{ invoice.customer.credit_balance|floatformat:0|intcomma }}ƒë</span></li>
            <li class="list-group-item"><strong>Ng√†y t·∫°o:</strong> {{ invoice.created_at|date:"d/m/Y H:i" }}</li>
            <li class="list-group-item"><strong>Tr·∫°ng th√°i:</strong> 
                {% if invoice.status == 'paid' %}<span class="badge bg-success">ƒê√£ thanh to√°n</span>
                {% elif invoice.status == 'unpaid' %}<span class="badge bg-warning text-dark">Ch∆∞a thanh to√°n</span>
                {% else %}<span class="badge bg-danger">ƒê√£ h·ªßy</span>
                {% endif %}
            </li>
        </ul>
    </div>
    
    <div class="card mt-4">
        <div class="card-header fw-bold">
            Chi ti·∫øt m·ª•c
        </div>
        <div class="table-responsive">
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>S·∫£n ph·∫©m/D·ªãch v·ª•</th>
                        <th class="text-end">ƒê∆°n gi√°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for detail in invoice.details.all %}
                    <tr>
                        <td>
                            {% if detail.product %}{{ detail.product.name }}{% endif %}
                            {% if detail.service %}{{ detail.service.name }}{% endif %}
                            {% if detail.service_package %}{{ detail.service_package.name }}{% endif %}
                        </td>
                        <td class="text-end">{{ detail.unit_price|floatformat:0|intcomma }}ƒë</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-end"><strong class="me-3">T·∫°m t√≠nh:</strong> {{ invoice.sub_total|floatformat:0|intcomma }}ƒë</div>
            <div class="d-flex justify-content-end text-danger"><strong class="me-3">Gi·∫£m gi√°:</strong> -{{ invoice.discount_amount|floatformat:0|intcomma }}ƒë</div>
            <hr>
            <div class="d-flex justify-content-end fs-5 fw-bold"><strong class="me-3">Th√†nh ti·ªÅn:</strong> {{ invoice.final_amount|floatformat:0|intcomma }}ƒë</div>
            <div class="d-flex justify-content-end fs-5 fw-bold text-success"><strong class="me-3">ƒê√£ thanh to√°n:</strong> {{ invoice.paid_amount|floatformat:0|intcomma }}ƒë</div>
            <div class="d-flex justify-content-end fs-5 fw-bold text-danger">
                <strong class="me-3">C·∫ßn thanh to√°n th√™m:</strong> 
                <span>
                    {% if invoice.amount_due > 0 %}
                        {{ invoice.amount_due|floatformat:0|intcomma }}ƒë
                    {% else %}
                        0ƒë
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</div>
{% endblock %}