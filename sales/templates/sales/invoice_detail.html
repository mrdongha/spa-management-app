{% extends 'sales/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ page_title }}</h1>
    <div>
        {% if invoice.status == 'unpaid' %}
            <a href="{% url 'record_payment' invoice.id %}" class="btn btn-success">Thanh toán ngay</a>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-header fw-bold">
        Thông tin chung
    </div>
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Khách hàng:</strong> {{ invoice.customer.full_name }}</li>
        <li class="list-group-item"><strong>Ngày tạo:</strong> {{ invoice.created_at|date:"d/m/Y H:i" }}</li>
        <li class="list-group-item"><strong>Trạng thái:</strong> 
            {% if invoice.status == 'paid' %}
                <span class="badge bg-success">Đã thanh toán</span>
            {% elif invoice.status == 'unpaid' %}
                <span class="badge bg-warning text-dark">Chưa thanh toán</span>
            {% else %}
                <span class="badge bg-danger">Đã hủy</span>
            {% endif %}
        </li>
    </ul>
</div>

<div class="card mt-4">
    <div class="card-header fw-bold">
        Chi tiết mục
    </div>
    <div class="table-responsive">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th>Sản phẩm/Dịch vụ</th>
                    <th class="text-end">Đơn giá</th>
                </tr>
            </thead>
            <tbody>
                {% for detail in invoice.details.all %}
                <tr>
                    <td>
                        {% if detail.product %}{{ detail.product.name }}{% endif %}
                        {% if detail.service %}{{ detail.service.name }}{% endif %}
                        {% if detail.service_package %}{{ detail.service_package.name }}{% endif %}
                        {% if detail.gift_card %}{{ detail.gift_card.name }}{% endif %}
                    </td>
                    <td class="text-end">{{ detail.unit_price|floatformat:0 }}đ</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="card-footer">
        <div class="d-flex justify-content-end"><strong class="me-3">Tạm tính:</strong> {{ invoice.sub_total|floatformat:0 }}đ</div>
        <div class="d-flex justify-content-end text-danger"><strong class="me-3">Giảm giá:</strong> -{{ invoice.discount_amount|floatformat:0 }}đ</div>
        <hr>
        <div class="d-flex justify-content-end fs-5 fw-bold"><strong class="me-3">Thành tiền:</strong> {{ invoice.final_amount|floatformat:0 }}đ</div>
        <div class="d-flex justify-content-end fs-5 fw-bold text-success"><strong class="me-3">Đã thanh toán:</strong> {{ invoice.paid_amount|floatformat:0 }}đ</div>
        <div class="d-flex justify-content-end fs-5 fw-bold text-danger"><strong class="me-3">Còn lại:</strong> {{ invoice.amount_due|floatformat:0 }}đ</div>
    </div>
</div>
{% endblock %}