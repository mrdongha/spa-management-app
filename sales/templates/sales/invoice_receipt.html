{% extends 'sales/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<style>
    .invoice-box {
        max-width: 800px;
        margin: auto;
        padding: 30px;
        border: 1px solid #eee;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        font-size: 16px;
        line-height: 24px;
        font-family: 'Helvetica Neue', 'Helvetica', Helvetica, Arial, sans-serif;
        color: #555;
    }
    @media print {
        body > nav.no-print, .no-print { display: none !important; }
        .invoice-box { box-shadow: none; border: none; margin: 0; padding: 0; }
    }
</style>

<div class="no-print d-flex justify-content-end mb-3">
    <button onclick="window.print()" class="btn btn-sm btn-outline-secondary">ğŸ–¨ï¸ In hÃ³a Ä‘Æ¡n</button>
</div>

<div class="invoice-box">
    <div class="text-center mb-4">
        <h2 class="fw-bold">SHINE BEAM</h2>
        <p class="mb-0">Äá»‹a chá»‰: [Äiá»n Ä‘á»‹a chá»‰ cá»§a báº¡n vÃ o Ä‘Ã¢y]</p>
        <p class="mb-0">Äiá»‡n thoáº¡i: [Äiá»n SÄT cá»§a báº¡n vÃ o Ä‘Ã¢y]</p>
    </div>
    <hr>
    <h3 class="text-center mb-4">HÃ“A ÄÆ N THANH TOÃN</h3>

    <table class="table table-borderless table-sm mb-4">
        <tbody>
            <tr>
                <td><strong>KhÃ¡ch hÃ ng:</strong></td><td>{{ invoice.customer.full_name }}</td>
                <td><strong>HÃ³a Ä‘Æ¡n sá»‘:</strong></td><td>#{{ invoice.id }}</td>
            </tr>
            <tr>
                <td><strong>NhÃ¢n viÃªn:</strong></td><td>{{ invoice.staff.username|default:"N/A" }}</td>
                <td><strong>NgÃ y táº¡o:</strong></td><td>{{ invoice.created_at|date:"d/m/Y H:i" }}</td>
            </tr>
             <tr>
                <td><strong>Sá»‘ dÆ° tÃ­n dá»¥ng:</strong></td><td class="fw-bold text-primary">{{ invoice.customer.credit_balance|floatformat:0|intcomma }}Ä‘</td>
                <td><strong>Tráº¡ng thÃ¡i:</strong></td>
                <td>
                    {% if invoice.status == 'paid' %}<span class="badge bg-success">ÄÃ£ thanh toÃ¡n</span>
                    {% elif invoice.status == 'unpaid' %}<span class="badge bg-warning text-dark">ChÆ°a thanh toÃ¡n</span>
                    {% else %}<span class="badge bg-danger">ÄÃ£ há»§y</span>
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
    
    <table class="table">
        <thead class="table-light">
            <tr>
                <th>Sáº£n pháº©m/Dá»‹ch vá»¥</th>
                <th class="text-end">ÄÆ¡n giÃ¡</th>
            </tr>
        </thead>
        <tbody>
            {% for detail in invoice.details.all %}
            <tr>
                <td>
                    {% if detail.product %}{{ detail.product.name }}{% endif %}
                    {% if detail.service %}{{ detail.service.name }}{% endif %}
                    {% if detail.service_package %}{{ detail.service_package.name }}{% endif %}
                </td>
                <td class="text-end">{{ detail.unit_price|floatformat:0|intcomma }}Ä‘</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-end mt-4">
        <div class="w-50">
            <div class="d-flex justify-content-between">
                <strong class="me-3">Táº¡m tÃ­nh:</strong> <span>{{ invoice.sub_total|floatformat:0|intcomma }}Ä‘</span>
            </div>
            <div class="d-flex justify-content-between text-danger">
                <strong class="me-3">Giáº£m giÃ¡:</strong> <span>-{{ invoice.discount_amount|floatformat:0|intcomma }}Ä‘</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between fs-5 fw-bold">
                <strong class="me-3">ThÃ nh tiá»n:</strong> <span>{{ invoice.final_amount|floatformat:0|intcomma }}Ä‘</span>
            </div>
            <div class="d-flex justify-content-between fs-5 fw-bold text-success">
                <strong class="me-3">ÄÃ£ thanh toÃ¡n:</strong> <span>{{ invoice.paid_amount|floatformat:0|intcomma }}Ä‘</span>
            </div>
            <div class="d-flex justify-content-between fs-5 fw-bold text-danger">
                <strong class="me-3">Cáº§n thanh toÃ¡n thÃªm:</strong> 
                <span>
                    {% if invoice.amount_due > 0 %}{{ invoice.amount_due|floatformat:0|intcomma }}Ä‘{% else %}0Ä‘{% endif %}
                </span>
            </div>
        </div>
    </div>
</div>
{% endblock %}